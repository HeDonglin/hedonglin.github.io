---
title: Git理解图
date: 2017-06-17 00:41:30
categories: 辅助工具
tags: git
---

## 一边操作一边理解
<img src="/images/git-1.png" alt="git理解图" title="git理解图">
## 本地创建公钥(提供到服务端,可删除但不建议),和密钥(克隆下来的文件会根据已提交到服务端的公钥去匹配相应的密钥)
```javascript
    //~代表用户名目录下,$HOME 用户目录变量,下面表示转到用户目录的.ssh文件夹下
    cd ~/.shh
    //创建一个公钥
        ssh-keygen -t rsa -C "注释,标识身份,一般添github上的邮箱地址"
    //创建多个公钥(相当于1台电脑可以控制两个github账户)
        ssh-keygen -t rsa -C "aaa@163.com" //一路回车,那么默认文件命名为id_rsa
        ssh-keygen -t rsa -C "bbb@163.com" //回车后要求为文件进行命名可设置为id2_rsa
        //当克隆下来的文件时:git@github.com:xyhdl0929/abc.git会寻找本机中的ssh秘钥
        //在.ssh文件夹下新建config文件添加以下信息;
            # 第一个账号，默认使用的账号
                Host github.com
                HostName github.com
                User git
                IdentityFile ~/.ssh/id_rsa #对应github第一个账号
            # 第二个账号
                Host n.github.com  #n为前缀名，可以任意设置
                HostName github.com
                User git
                IdentityFile ~/.ssh/id2_rsa #对应github第二个账号
```

## 远程服务器github设置;
```javascript
    //把公钥(*.pub的文件就是公钥)内容添加到ssh中,title名字用户身份填写;
    Settings-->SSH and GPG keys-->New SSH key--title(随意,一般写哪个用户使用的公钥)-->粘贴公钥
    //github上新建一个仓库
    New repository-->Repository name(随意)-->create pository
    //复制ssh地址;例如git@github.com:HeDonglin/muban.git
    clone or download-->copy to clipboard
```

## 初始化及忽略文件设置
```javascript
    //初始化命令在文件夹里生成一个隐藏的.git文件夹，这是一个全新的状态，不管该文件夹有没有文件；
        git init
    //添加忽略的文件
        //未跟踪状态的忽略设置:
            .gitignore //都需要忽略的文件,建立方式(.gitignore.),该文件和.git文件夹同级
                .css //例如:使用less编译,最终生成css,那么可以忽略编译生成的中间文件/可执行文件;
            exclde //本地仓库需要忽略的文件,该文件在.git/info中;
                dist/
                build/
                node_modules/
        //已跟踪状态的忽略设置:(比如克隆下来的文件都是属于跟踪状态,没改变也没在已暂存)
            //对已改变的文件进行忽略跟踪,但还可以进行恢复跟踪,说明还保留在已跟踪状态只是对他进行了忽略而已,并没设置为未跟踪状态;
                git update-index --assume-unchanged <file>//忽略跟踪
                git update-index --no-assume-unchanged <file>//恢复跟踪
            //对已暂存的文件或文件夹移出已暂存并设置为未跟踪状态,不删除文件,那么上面的的两条命令就无效了,因为彻底地设置为未跟踪状态;
                git rm --cached <文件>
                git rm --cached <文件夹> -r
```

## 配置信息大全
```javascript
    //查看所有配置信息,看是否有使用过的用户记录;
        git config --list 

    //git命令自动纠错，如：gitstats会被自动纠正成git status执行
        Git config --global help.autocorrect

    //.git文件夹下config设置配置，具有优先权
        git config user.name "用户名" 
        git config user.email "邮箱地址" 
    //用户者是谁,方便记录谁操作了仓库（必须）
        git config --global user.name "用户名" 
    //用户的邮箱地址,方便记录使用者邮箱地址（必须）
        git config --global user.email "邮箱地址" 
    //删除全局配置文件中的使用者信息
        git config --global --unset user.name 
    //删除全局配置文件中的使用者的邮件地址
        git config --global --unset user.email 

    //免用户名和密码登录github（必须）
        git config --global credential.helper store 

    //是否忽略文件夹大小写敏感，false表示不忽略也就是对大小写敏感，false即是所有平台使用（跨平台必须）
        git config --global core.ignorecase false

    //git add 时候LF 会被转化成 CRLF；
    //git checkout切换分支时候，换行符转化为 CRLF；
    //git commit 提交时候CRLF转LF
    //因为远程仓库一般都是纯的LF,在window下编辑器（如sublime text）使用LF设置即可；这时候就不需要git进行转换了；所以设置false即可
    //提交时转换为LF，检出时转换为CRLF（window下设置，编辑不是LF的时候设置）
        git config --global core.autocrlf true
    //提交时转换为LF，检出时不转换（非window下设置）
        git config --global core.autocrlf input
    //提交检出均不转换
        git config --global core.autocrlf false

    //由于上面已经保证了，所有文件都采用LF了这里可以设置为false;如果为了安全起见可以使用warn来提醒哪些文件采用混合换行符
    //拒绝提交包含混合换行符的文件（跨平台）
        git config --global core.safecrlf true
    //允许提交包含混合换行符的文件
        git config --global core.safecrlf false
    //提交包含混合换行符的文件时给出警告
        git config --global core.safecrlf warn

    //默认使用哪种编辑器打开便于对内容修改(必须)
        git config --global core.editor "'D:\Program Files\Sublime Text 3126\sublime_text.exe' -w"

    //push推送到远程主机的时候设置simple模式，，只有当前分支会被 push；（必须）
        git config --global push.default simple
    //push推送到远程主机的时候设置matching模式，把所有分支都push
        git config --global push.default matching

    //git status发现 \316\304\261\276\316\304\265\265.txt（必须）
        git config --global core.quotepath false
    //提交信息编码
        git config --global i18n.commit.encoding utf-8
    //输出 log 编码
        git config --global i18n.logoutputencoding utf-8
    //图形界面编码
        git config --global gui.encoding utf-8

    //（手动修改的文件profile）git log 默认使用 less 分页,bash 对 less 命令进行 utf-8 在Git\etc\profile文件中添加：注意=号前后不能有空格
        export LESSCHARSET=utf-8
```

## 克隆仓库
```javascript
//克隆github上的仓库
    //例如:git@github.com:xyhdl0929/abc.git 采用的是id2_rsa.push公钥,而此公钥在本地采用的域名为n.github.com,那么克隆的时候就改为git@n.github.com:xyhdl0929/abc.git;
        git clone <仓库ssh地址> <本地新仓库名,可选默认为远程仓库名>
    //更改远程主机名
        git clone -o <设置远程主机名,可选忽略时默认为origin> <仓库ssh地址>
```

## 新建立的文件或文件夹
```
    //空的文件夹（不会显示为未跟踪）
    //文件和带有文件的文件夹（显示为未跟踪）
```

## 提交本地仓库
```javascript
    //提交所有已改变和已暂存的文件
    git commit -m "提交所有已改变和已暂存的文件" -a
    //提交所有已暂存的文件
    git commit -m "提交所有已暂存的文件"
    //提交指定已暂存的文件
    git commit -m "提交指定已修改的" <文件名>
```

## 添加到已暂存
```javascript
    //新建立的文件,添加到已暂存
        git add <文件夹或文件>
    //克隆下来的文件,处于已跟踪未暂存（注意：是修改后才可以添加到已暂存）
        git add <克隆下来的文件夹或文件>
    //添加所有文件和文件夹（包括克隆已修改的文件或文件夹）到已暂存（常用）
        git add .
```

## 对比文件
```javascript
    //对已改变的文件
        git diff
    //对比已暂存的文件
        git diff --cached
```

## 更改文件名，如果文件名有空格需要双引号
```javascript
    git mv <旧文件名> <新文件名>
```

## 删除本地文件(除了克隆的文件其他都需要经过git add)
```javascript
    //  -r 允许递归删除
    //  -q 不要列出删除的文件（注意:并不是status中列出是在输入命名后列出的内容）
    //  -f 用于删除新建后添加的文件或文件夹不保留在status中
    //删除文件
        //删除克隆下来的文件（保存在status中)
            git rm <文件>
        //删除已暂存区中的文件，（记录不会保存在status中）
            git rm -f <文件>

    //删除文件夹（-r）
        //删除克隆下来的文件夹、文件（记录保存在status）；
            git rm -r <文件夹>
        //删除新建的添加已暂存的文件夹（记录不会保存在status中）
            git rm -r -f<文件夹>

    //移出已跟踪状态不删除文件(文件)，（如果是文件夹添加递归命名-r）
        git rm --cached <文件>
        git rm --cached -r <文件夹> 
```

## 提交日志
```javascript
    //记录所有HEAD的历史, 回退版本时候git log只会显示当前版本之前的记录；对未来版本不会显示所以要用reflog;当前版本始终显示为HEAD{0}，最初的版本显示在最后
    // 183851a HEAD@{0}: commit: 第三次提交
    // 85ce5fd HEAD@{1}: reset: moving to head~1（回退到第一次提交）
    // b69e62a HEAD@{2}: commit: 第二次提交
    // 85ce5fd HEAD@{3}: commit (initial): 第一次提交

    git reflog
    //显示当前版本提交之前的所有记录
    git log
    //每次提交中，每个文件加入(insertion)和删除(deletions)的行数(修改一行等同加入一行和删除一行)
    git log --stat
    //改动的详细信息
    git log -p
    //提交记录汇总成一行
    git log --oneline
    //commit的关联分支或者标签
    git log --decorate
    //根据分枝提交历史绘出图像
    git log --graph
    //结合以上三个一起使用最好看
    git log --oneline --decorate --graph
    //查看每个人员的提交信息汇总，按每个提交者名字排序，传入-n参数按每个人的提交次数排序
    git shortlog
    //自定义输出格式：%cn,提交者姓名;%h,hash缩写;%cd,日期
    git log --pretty=format:"%cn committed %h on %cd"
    //过滤提交历史
    //根据数量过滤，最近3条
    git log -3
    //根据日期过滤,--after在日期之后；--before在日期之前
    git log --after="2017.1.1"
    git log --before="2017.3.5"
    //按提交者过滤
    git log --author="aaa"
    //根据文件过滤，筛选某个文件的提交，可传入多个参数
    git log -- 文件名 文件名
    //根据改动过滤，表示某个内容何时加入到文件中；
    git log -S"内容"
    //展示两个分支的不同
    //例如展示两个分支不同的提交；如果backup是master 第一次提交后建立的分支那么
    git log master..backup//显示backup分支后所有的提交
    //当切回到master继续工作后又有了提交
    git log backup..master//那么显示分支master提交后的分支,但不显示master分支的第一提交；
    //过滤合并的信息
    git log --no-merges
    //查看合并的信息
    git log --merges
```

## 回滚操作
```javascript
    //指定移除哪些文件或文件夹到未跟踪状态；（常用）
        git reset <文件夹、文件> //推荐使用这个
    //还没提交，把所有已经提交的非克隆下来的文件撤出跟踪状态；对克隆下来的文件经过修改撤出到未跟踪状态保留已修改的内容；
        git reset head
        git reset .
        git reset 

    //git reset --hard , (对已经使用过git add的)文件或文件名都会清除，对未使用过git add的文件保留；当文件提交后悔产生git log git relog 历史记录
    //回滚到上一个版本，注意head和^之间没有空格
        git reset head^
    //回滚到上上次版本
        git reset head^^
    //head最新版本始终是0，共提交了3个版本那么回滚到最初的版本就是2了；（常用）
        git reset head~2

    //查看版本功能具备以下有三个作用
        //1.新建的文件已暂存没提交状态回到新建文件之前也就该文件消失
        //2.克隆下来的文件，修改后添加到暂存，使用命令后回到克隆下来的状态，不保留已修改的内容
        //3.已提交状态，提示当前位置的HEAD版本）
        git reset --hard
    //回滚的同时指出在哪个版本,共提交了3个版本那么回滚到最初的版本就是2了
        git reset --hard head~2
    //回滚到未来版本，使用git reflog查看版本号接着git reset --hard <版本号>回到未来（常用）
        git reset --hard <指定版本号>
        
    //恢复被git reset --hard第一种情况
        git fsck --lost-found

    //在已暂存中改变的文件进行撤销修改；
        git checkout <文件名>
```

## 查看分支,所有未跟踪状态和跟踪状态都属于所有分支;
```javascript
    //会列出你在本地的分支。你所在的分支的行首会有个星号作标记。 当前分支会用绿色显示（提交后可以查看），书写命令的上一行最后显示当前所在分支
    git branch
    //查看远程分支
    git branch -r
    //查看所有分支(包括本地分支)
    git branch -a
    //查看追踪的远程分支同时知道哈希码
    git branch -vv
    //删除未合并的分支
    git branch -d <分支名>
    //删除已合并的分支，强制删除
    git branch -D <分支名>
    //恢复误删的分支
    git reflog //查看哈希值
    git branch c 版本哈希值(前7位数)//表示某个版本恢复到c分支；
    //重名分支
    git branch -m 旧分支名 新分支名
    git branch -M 旧分支名 新分支名 (如果新分支名已经存在使用这个强制重命名)
    //在本地创建分支
    git branch <新分支名>
    //切换分支,用git branch 查看本地分支的时会看到绿显示;
    git checkout <新分支名>
    //切换分支前需要commit否则无法切换；比如backup分支没提交需要切换到master可以选择stash；可以保存多个状态
    git stash
    //上面已经切换到了master，我们在切回到backup继续工作
    git stash apply
    //查看stash列表
    git stash list
    //清除列表
    git stash clear
    //选择需要恢复的stash列表，只需改变数字即可
    git stash apply stash@{0}
    //创建新分支并立即切换,对于新建立的文件没有提交状态下(也就是未跟踪状态和跟踪状态下)的情况来回切换分支文件还是会显示的,一旦提交了就不会显示了
    git checkout -b <新分支名>
    //本地创建一个新的分支,并让该新的分支与远程主机某个分支建立追踪关系,该分支下的pull和push同步远程分支
    //所取回的更新，在本地主机上要用"远程主机名/分支名"的形式读取
    git checkout -b <新的分支名> 远程主机名/分支名
```

## 远程主机
```javascript
    //列出所有远程主机,默认为origin
    git remote
    //同时查看远程主机对应的仓库地址
    git remote -v 
    //查看远程主机的详细信息
    git remote show <远程主机名>
    //添加远程主机,设置远程主机名
    //如果是删除远程主机名后再进行添加的主机,那么该主机没有远程分支;此时可以使用git fetch <远程主机名> master 的分支拉回本地
    git remote add <设置远程主机名> <仓库ssh地址>
    //删除远程主机
    //比如克隆的时候发现域名没更改导致无法提交,这时候可以删除远程主机重新添加远程主机
    git remote rm <远程主机名>
    //远程主机改名
    git remote rename <原主机名> <新主机名>
```

## 远程更新取回本地(默认取回所有分支branch)
```javascript
    git fetch <远程主机名>
    //取回指定的分支更新
    git fetch <远程主机名> <分支名>
    //把分支名合并到当前分支（常用）
    git merge(或者rebase衍合) <分支名>
    //解决合并时候的冲突，cat打开选择需要保留的文件，HEAD表示当前分支，选择后然后git add git commit -m '';
    //查看文件
    cat <冲突的文件>
```

## 为版本库创建标签
```javascript
    //查看所有标签
    git tag 
    //新建一个标签，默认为HEAD，也可以指定一个commit id
    git tag <name> 
    //推送一个本地标签
    git push origin <tagname> 
    //推送全部未推送过的本地标签
    git push origin --tags 
    //删除一个本地标签
    git tag -d <tagname> 
    //删除一个远程标签
    git push origin :refs/tags/<tagname> 
```

## 取回远程主机某个分支的更新，再与本地的指定分支合并
```javascript
    git pull <远程主机名> <远程分支名>:<本地分支名>
    //如果远程分支是与当前分支合并，则冒号后面的部分可以省略。
    git pull <远程主机名> <远程分支名>
    //实际过程为
        git fetch <远程主机名>
        git merge 远程主机名/分支名
    //git clone的时候，所有本地分支默认与远程主机的同名分支，建立追踪关系，也就是说，本地的master分支自动"追踪"origin/master分支。
    //就能够看到本地分支跟踪的远程分支
    git branch -vv
    //手动建立追踪关系
    git branch --set-upstream master origin/master//表示指定master分支追踪origin/master   
    //如果合并需要采用rebase模式，可以使用--rebase选项。
    git pull --rebase <远程主机名> <远程分支名>:<本地分支名>
    //参数 -p 就会在本地删除远程已经删除的分支。
    git pull -p
```

## 推送到远程主机
```javascript
    //将本地分支的更新,推送到远程主机(远程没有分支的时候使用，接着进行追踪分支)
    git push <远程主机名> <本地分支名>:<远程分支名>
    //将本地的master分支推送到远程主机的master
    git push <远程主机名> master
    //本地新建的分支名推送到远程主机，远程主机会自动新建一个新分支名；
    git push <远程主机名> 新分支名
    //省略本地分支分支名,则表示删除指定的远程分支,因为等于推送了一个空的本地分支到远程分支(重要)master不允许删除，其他都可以
    git push <远程主机名> :<远程分支名>
    //当前分支只有一个追踪分支,那么主机名都可以省略
    //‘matching’ 参数是 Git 1.x 的默认行为，其意是如果你执行 git push 但没有指定分支，它将 push 所有你本地的分支到远程仓库中对应匹配的分支。
    //而 Git 2.x 默认的是 simple，意味着执行 git push 没有指定分支时，只有当前分支会被 push 到你使用 git pull 获取的代码。
    //
    git push
    //当前分支与多个主机存在追踪关系,那么可以指定默认主机,以后就可以直接git push
    git push -u <默认主机> <本地分支>
    //不管是否存在对应的远程分支,将本地的所有分支都推送到远程主机,-all;
    git push --all <主机名>
    //远程主机版本比本地的更新,推送的时候会报错,要求先在本地做git pull合并差异，然后再推送到远程主机。如果一定要推送那么可以使用;
    //如果发现第一次推送错误，回滚操作后使用git push -f强推覆盖远程主机错误的版本
    git push -f <主机名>
    //推送的时候出错，原因是远程分支比本地的分支更新，那么必须先把远程的分支git pull 取回与当前分支合并后，才使用git push;
    git pull
    git push
    //推送标签(默认是不推送标签的)
    git push <主机名> --tags
    //更新所有远程分支
    git branch | awk 'BEGIN{print "echo ****Update all local branch...@daimon***"}{if($1=="*"){current=substr($0,3)};print a"git checkout "substr($0,3);print "git pull --all";}END{print "git checkout " current}' |sh

    //是否禁用强制功能-f;
    git config receive.denyNonFastForwards false
```
